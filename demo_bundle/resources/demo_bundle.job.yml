variables:
  my_cluster:
    description: "Cluster configuration for the new cluster"
    type: complex
    default:
      spark_version: "13.2.x-scala2.11"
      node_type_id: "Standard_DS3_v2"
      num_workers: 2
      spark_conf:
        spark.speculation: "true"
        spark.databricks.delta.retentionDurationCheck.enabled: "false"

  my_lookup_cluster_id:
    description: "ID of existing cluster found by name"
    lookup:
      cluster: "Simbus_DBRX_Cluster"

  my_notebook_path:
    description: "Path to the notebook to run"
    type: string
    default: "/Workspace/Users/meghana.tripathi@simbustech.com/asset_bundle_demo_task/demo_bundle/src/notebook"

resources:
  jobs:
    demo_bundle_job:
      name: demo_bundle_job

      job_clusters:
        - job_cluster_key: my_cluster_key
          new_cluster: ${var.my_cluster}

      job_clusters:
        - job_cluster_key: lookup_cluster_key
          existing_cluster_id: ${var.my_lookup_cluster_id}

      tasks:
        - task_key: run_notebook_with_new_cluster
          job_cluster_key: my_cluster_key
          notebook_task:
            notebook_path: ${var.my_notebook_path}
            base_parameters:
              environment: ${bundle.target}
              message: "Hello from new cluster"

        - task_key: run_notebook_with_lookup_cluster
          job_cluster_key: lookup_cluster_key
          notebook_task:
            notebook_path: ${var.my_notebook_path}
            base_parameters:
              environment: ${bundle.target}
              message: "Hello from lookup cluster"
